<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.1.163">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Tommaso Rigon">

<title>R per l’analisi statistica multivariata</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>

  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<link rel="stylesheet" href="../styles.css">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="../index.html">
    <span class="navbar-title">R per l’analisi statistica multivariata</span>
    </a>
  </div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../index.html">Home</a>
  </li>  
</ul>
              <div id="quarto-search" class="" title="Search"></div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Contenuto della pagina</h2>
   
  <ul>
  <li><a href="#argomenti-affrontati" id="toc-argomenti-affrontati" class="nav-link active" data-scroll-target="#argomenti-affrontati">Argomenti affrontati</a></li>
  <li><a href="#un-breve-sommario" id="toc-un-breve-sommario" class="nav-link" data-scroll-target="#un-breve-sommario">Un breve sommario</a></li>
  <li><a href="#ripasso-notazione" id="toc-ripasso-notazione" class="nav-link" data-scroll-target="#ripasso-notazione">Ripasso &amp; notazione</a></li>
  <li><a href="#ripasso-e-notazione" id="toc-ripasso-e-notazione" class="nav-link" data-scroll-target="#ripasso-e-notazione">Ripasso e notazione</a></li>
  <li><a href="#la-stima-di-massima-verosimiglianza" id="toc-la-stima-di-massima-verosimiglianza" class="nav-link" data-scroll-target="#la-stima-di-massima-verosimiglianza">La stima di massima verosimiglianza</a></li>
  <li><a href="#parametro-scalare-modello-esponenziale" id="toc-parametro-scalare-modello-esponenziale" class="nav-link" data-scroll-target="#parametro-scalare-modello-esponenziale">Parametro scalare: modello esponenziale</a></li>
  <li><a href="#parametro-scalare-modello-esponenziale-1" id="toc-parametro-scalare-modello-esponenziale-1" class="nav-link" data-scroll-target="#parametro-scalare-modello-esponenziale-1">Parametro scalare: modello esponenziale</a></li>
  <li><a href="#le-funzione-vettorizzabili-i" id="toc-le-funzione-vettorizzabili-i" class="nav-link" data-scroll-target="#le-funzione-vettorizzabili-i">Le funzione <em>vettorizzabili</em> I</a></li>
  <li><a href="#le-funzioni-vettorizzabili-ii" id="toc-le-funzioni-vettorizzabili-ii" class="nav-link" data-scroll-target="#le-funzioni-vettorizzabili-ii">Le funzioni <em>vettorizzabili</em> II</a></li>
  <li><a href="#qualche-cenno-alle-performance" id="toc-qualche-cenno-alle-performance" class="nav-link" data-scroll-target="#qualche-cenno-alle-performance">Qualche cenno alle performance</a></li>
  <li><a href="#la-stima-di-massima-verosimiglianza-1" id="toc-la-stima-di-massima-verosimiglianza-1" class="nav-link" data-scroll-target="#la-stima-di-massima-verosimiglianza-1">La stima di massima verosimiglianza</a></li>
  <li><a href="#procedure-numeriche" id="toc-procedure-numeriche" class="nav-link" data-scroll-target="#procedure-numeriche">Procedure numeriche</a></li>
  <li><a href="#il-metodo-di-newton-raphson-i" id="toc-il-metodo-di-newton-raphson-i" class="nav-link" data-scroll-target="#il-metodo-di-newton-raphson-i">Il metodo di Newton-Raphson I</a></li>
  <li><a href="#il-metodo-di-newton-raphson-ii" id="toc-il-metodo-di-newton-raphson-ii" class="nav-link" data-scroll-target="#il-metodo-di-newton-raphson-ii">Il metodo di Newton-Raphson II</a></li>
  <li><a href="#metodi-di-massimizzazione" id="toc-metodi-di-massimizzazione" class="nav-link" data-scroll-target="#metodi-di-massimizzazione">Metodi di massimizzazione</a></li>
  <li><a href="#la-funzione-nlminb" id="toc-la-funzione-nlminb" class="nav-link" data-scroll-target="#la-funzione-nlminb">La funzione <code>nlminb</code></a></li>
  <li><a href="#adeguatezza-del-modello" id="toc-adeguatezza-del-modello" class="nav-link" data-scroll-target="#adeguatezza-del-modello">Adeguatezza del modello</a></li>
  <li><a href="#parametro-vettoriale-il-modello-weibull-i" id="toc-parametro-vettoriale-il-modello-weibull-i" class="nav-link" data-scroll-target="#parametro-vettoriale-il-modello-weibull-i">Parametro vettoriale: il modello Weibull I</a></li>
  <li><a href="#parametro-vettoriale-il-modello-weibull-ii" id="toc-parametro-vettoriale-il-modello-weibull-ii" class="nav-link" data-scroll-target="#parametro-vettoriale-il-modello-weibull-ii">Parametro vettoriale: il modello Weibull II</a></li>
  <li><a href="#grafico-della-verosimiglianza-i-facoltativo" id="toc-grafico-della-verosimiglianza-i-facoltativo" class="nav-link" data-scroll-target="#grafico-della-verosimiglianza-i-facoltativo">Grafico della verosimiglianza I (facoltativo)</a></li>
  <li><a href="#grafico-della-verosimiglianza-ii-facoltativo" id="toc-grafico-della-verosimiglianza-ii-facoltativo" class="nav-link" data-scroll-target="#grafico-della-verosimiglianza-ii-facoltativo">Grafico della verosimiglianza II (facoltativo)</a></li>
  <li><a href="#stima-di-massima-verosimiglianza" id="toc-stima-di-massima-verosimiglianza" class="nav-link" data-scroll-target="#stima-di-massima-verosimiglianza">Stima di massima verosimiglianza</a></li>
  <li><a href="#stima-di-massima-verosimiglianza-1" id="toc-stima-di-massima-verosimiglianza-1" class="nav-link" data-scroll-target="#stima-di-massima-verosimiglianza-1">Stima di massima verosimiglianza</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">R per l’analisi statistica multivariata</h1>
<p class="subtitle lead">Unità K: analisi di verosimiglianza</p>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Tommaso Rigon </p>
          </div>
  </div>
    
    
  </div>
  

</header>

<section id="argomenti-affrontati" class="level2">
<h2 class="anchored" data-anchor-id="argomenti-affrontati">Argomenti affrontati</h2>
<ul>
<li>Aspetti numerici legati all’inferenza tramite verosimiglianza</li>
<li>Stima numerica di massima verosimiglianza</li>
<li>Il caso multiparametrico (grafici <code>contour</code>)</li>
</ul>
<div class="callout-note callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Nota
</div>
</div>
<div class="callout-body-container callout-body">
<p>Gli esercizi <strong>R</strong> associati sono disponibili a <a href="https://tommasorigon.github.io/introR/exe/es_4.html">questo link</a></p>
</div>
</div>
</section>
<section id="un-breve-sommario" class="level2">
<h2 class="anchored" data-anchor-id="un-breve-sommario">Un breve sommario</h2>
<p>In questa unità procederemo tramite <strong>esempi</strong>, volti a mostrare alcuni <strong>aspetti numerici</strong> e <strong>grafici</strong> legati alla verosimiglianza in modelli parametrici.</p>
<p>In primo luogo, considereremo un esempio di modello con parametro <strong>scalare</strong>.</p>
<p>Quindi, considereremo un esempio modello con parametro <strong>vettoriale</strong>.</p>
<p>Per ovvie ragioni, non avremo tempo / modo di ripercorrere l’intero programma di Statistica II.</p>
<p>Pertanto è di fondamentale importanza che gli argomenti di <strong>inferenza statistica</strong> siano ben chiari.</p>
</section>
<section id="ripasso-notazione" class="level2">
<h2 class="anchored" data-anchor-id="ripasso-notazione">Ripasso &amp; notazione</h2>
<p>Nel caso assolutamente continuo, un <strong>modello statistico</strong> è una collezione di funzioni di densità <span class="math display">\[
\mathcal{F} = \{f(\cdot ; \theta) : \theta \in \Theta\},
\]</span> indicizzata da un vettori di parametri <span class="math inline">\(\theta \in \Theta\)</span>, dove <span class="math inline">\(\Theta \subseteq \mathbb{R}^p\)</span> è lo <strong>spazio parametrico</strong>.</p>
<p>Nel <strong>caso discreto</strong>, la definizione di modello statistico è la medesima, ma considerando delle funzioni di probabilità <span class="math inline">\(p(x ; \theta)\)</span> al posto delle densità.</p>
<p>Assumiamo inoltre che che <span class="math inline">\(y = (y_1,\dots,y_n)\)</span> sia un campione (spesso iid) con legge congiunta <span class="math inline">\(f(y; \theta)\)</span>, per un qualche <strong>ignoto</strong> valore del parametro <span class="math inline">\(\theta\)</span>.</p>
<p>Relativamente ad un modello statistico <span class="math inline">\(\mathcal{F}\)</span> di cui è stato osservato un campione <span class="math inline">\(y\)</span>, si chiama <strong>verosimiglianza</strong> la funzione da <span class="math inline">\(\Theta\)</span> in <span class="math inline">\(\mathbb{R} \cup \{0\}\)</span> <span class="math display">\[
\mathcal{L}(\theta) = \mathcal{L}(\theta; y) = C \: f(y; \theta),
\]</span> dove <span class="math inline">\(C = C(y)\)</span> è una costante positiva che non dipende da <span class="math inline">\(\theta\)</span>.</p>
</section>
<section id="ripasso-e-notazione" class="level2">
<h2 class="anchored" data-anchor-id="ripasso-e-notazione">Ripasso e notazione</h2>
<p>Assumiamo che campione <span class="math inline">\(y = (y_1,\dots,y_n)\)</span> sia composto da realizzazioni <strong>indipendenti</strong> ed <strong>identicamente distribute</strong> da una variabile casuale legge <span class="math inline">\(f(y; \theta)\)</span>. Quindi, si ottiene <span class="math display">\[
    \mathcal{L}(\theta) = \mathcal{L}(\theta; y) = C \: \prod_{i=1}^n f(y_i; \theta).
    \]</span></p>
<p>Dato che <span class="math inline">\(\mathcal{L}(\theta)\)</span> è non-negativa, spesso si lavora con la funzione di <strong>log-verosimiglianza</strong> <span class="math display">\[
    \ell(\theta) = \ell(\theta; y) = \log\mathcal{L}(\theta) = c + \sum_{i=1}^n\log f(y_i; \theta),
    \]</span> dove <span class="math inline">\(c \in \mathbb{R}\)</span> è una costante additiva che non dipende da <span class="math inline">\(\theta\)</span>.</p>
</section>
<section id="la-stima-di-massima-verosimiglianza" class="level2">
<h2 class="anchored" data-anchor-id="la-stima-di-massima-verosimiglianza">La stima di massima verosimiglianza</h2>
<p>La <strong>stima di massima verosimiglianza</strong> (SMV) è il valore <span class="math inline">\(\hat{\theta}\)</span> che rende massima la funzione di verosimiglianza <span class="math inline">\(\mathcal{L}(\theta)\)</span> sullo spazio <span class="math inline">\(\Theta\)</span>, cioè tale per cui <span class="math display">\[
\mathcal{L}(\hat{\theta}) = \sup_{\theta \in \Theta}\mathcal{L}(\theta).
\]</span></p>
<p>La SMV rende massimo anche la funzione di log-verosimiglianza, per cui <span class="math display">\[
\ell(\hat{\theta}) = \sup_{\theta \in \Theta}\ell(\theta).
\]</span></p>
<p>Di conseguenza, sotto opportune <strong>condizioni di regolarità</strong>, la SMV si ottiene come soluzione dell’equazione <span class="math inline">\(\ell'(\theta) = 0\)</span>.</p>
<p>Non è detto che la SMV esista.</p>
<p>La SMV <span class="math inline">\(\hat{\theta} = \hat{\theta}(y)\)</span> è una <strong>funzione del campione</strong>, anche se a volte tale funzione non è rappresentabile esplicitamente.</p>
</section>
<section id="parametro-scalare-modello-esponenziale" class="level2">
<h2 class="anchored" data-anchor-id="parametro-scalare-modello-esponenziale">Parametro scalare: modello esponenziale</h2>
<p>Sia <span class="math inline">\(y = (y_1,\dots,y_n)\)</span> un campione iid da una variabile casuale esponenziale con <strong>tasso di guasto</strong> <span class="math inline">\(\lambda\)</span>, ovvero <span class="math inline">\(Y \sim \text{Exp}(\lambda)\)</span>.</p>
<p>Si ricordi che la densità di un modello esponenziale è <span class="math display">\[
f(y; \lambda) = \lambda e^{-\lambda y}, \qquad y, \lambda &gt; 0.
\]</span></p>
<p>Di conseguenza, la funzione di log-verosimiglianza associata al campione <span class="math inline">\(y\)</span> è <span class="math display">\[
\ell(\lambda) = \ell(\lambda; y) = n \log \lambda - \lambda\sum_{i=1}^ny_i.
\]</span></p>
<div class="callout-note callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Esercizio
</div>
</div>
<div class="callout-body-container callout-body">
<p>Nel caso la derivazione di <span class="math inline">\(\ell(\lambda)\)</span> non fosse immediatamente chiara, si svolgano per esercizio tutti i passaggi.</p>
</div>
</div>
</section>
<section id="parametro-scalare-modello-esponenziale-1" class="level2">
<h2 class="anchored" data-anchor-id="parametro-scalare-modello-esponenziale-1">Parametro scalare: modello esponenziale</h2>
<p>La funzione che calcola la verosimiglianza in può essere implementata in vari modi.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>loglik <span class="ot">&lt;-</span> <span class="cf">function</span>(lambda, y) {</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">length</span>(y) <span class="sc">*</span> <span class="fu">log</span>(lambda) <span class="sc">-</span> lambda <span class="sc">*</span> <span class="fu">sum</span>(y)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>loglik2 <span class="ot">&lt;-</span> <span class="cf">function</span>(lambda, y) {</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">sum</span>(<span class="fu">dexp</span>(y, <span class="at">rate =</span> lambda, <span class="at">log =</span> <span class="cn">TRUE</span>))</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>loglik3 <span class="ot">&lt;-</span> <span class="cf">function</span>(lambda, y) {</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">sum</span>(<span class="fu">log</span>(lambda) <span class="sc">-</span> lambda <span class="sc">*</span> y)</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Consideriamo il dataset <code>aircondit7</code> della libreria <code>boot</code>, contenente i <strong>tempi di rottura</strong> relativi al sistema di condizionamento di alcuni aeroplani.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(boot)</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(<span class="st">"aircondit7"</span>)</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>y <span class="ot">&lt;-</span> aircondit7<span class="sc">$</span>hours</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">curve</span>(<span class="fu">loglik</span>(x, y), <span class="fl">1e-4</span>, <span class="fl">0.06</span>) <span class="co"># log-verosimiglianza nell'intervallo (0.001, 0.06)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="un_K_files/figure-html/unnamed-chunk-3-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="le-funzione-vettorizzabili-i" class="level2">
<h2 class="anchored" data-anchor-id="le-funzione-vettorizzabili-i">Le funzione <em>vettorizzabili</em> I</h2>
<p>Le tre funzioni implementate sono <strong>apparentemente</strong> equivalenti:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="fu">loglik</span>(<span class="fl">0.01</span>, y)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] -125.9141</code></pre>
</div>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="fu">loglik2</span>(<span class="fl">0.01</span>, y)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] -125.9141</code></pre>
</div>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="fu">loglik3</span>(<span class="fl">0.01</span>, y)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] -125.9141</code></pre>
</div>
</div>
<p>Tuttavia, solamente la prima è correttamente <strong>vettorizzata</strong>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Risultato corretto</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a><span class="fu">loglik</span>(<span class="fu">c</span>(<span class="fl">0.01</span>, <span class="fl">0.02</span>, <span class="fl">0.03</span>), y)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] -125.9141 -124.6686 -130.3274</code></pre>
</div>
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="co"># I seguenti comandi producono invece dei risultati errati</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="fu">loglik2</span>(<span class="fu">c</span>(<span class="fl">0.01</span>, <span class="fl">0.02</span>, <span class="fl">0.03</span>), y)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] -127.97</code></pre>
</div>
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="fu">loglik3</span>(<span class="fu">c</span>(<span class="fl">0.01</span>, <span class="fl">0.02</span>, <span class="fl">0.03</span>), y)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] -127.97</code></pre>
</div>
</div>
</section>
<section id="le-funzioni-vettorizzabili-ii" class="level2">
<h2 class="anchored" data-anchor-id="le-funzioni-vettorizzabili-ii">Le funzioni <em>vettorizzabili</em> II</h2>
<p>Il linguaggio <strong>R</strong> ama lavorare in modo <strong>vettoriale</strong> (e tipicamente odia i cicli <code>for</code>…)</p>
<p>Solamente <code>loglik</code> è una funzione <strong>vettorizzata</strong> rispetto al parametro <code>lambda</code>.</p>
<p>In altri termini, la funzione <code>loglik</code> può essere valutata in un vettore di punti ed il risultato sarà il vettore di valori di log-verosimiglianza associati.</p>
<p>Fortunatamente, le funzioni possono essere “convertite” come segue:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>loglik2 <span class="ot">&lt;-</span> <span class="fu">Vectorize</span>(loglik2, <span class="at">vectorize.args =</span> <span class="st">"lambda"</span>)</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>loglik3 <span class="ot">&lt;-</span> <span class="fu">Vectorize</span>(loglik3, <span class="at">vectorize.args =</span> <span class="st">"lambda"</span>)</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a><span class="fu">loglik</span>(<span class="fu">c</span>(<span class="fl">0.01</span>, <span class="fl">0.02</span>, <span class="fl">0.03</span>), y)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] -125.9141 -124.6686 -130.3274</code></pre>
</div>
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="fu">loglik2</span>(<span class="fu">c</span>(<span class="fl">0.01</span>, <span class="fl">0.02</span>, <span class="fl">0.03</span>), y)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] -125.9141 -124.6686 -130.3274</code></pre>
</div>
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="fu">loglik3</span>(<span class="fu">c</span>(<span class="fl">0.01</span>, <span class="fl">0.02</span>, <span class="fl">0.03</span>), y)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] -125.9141 -124.6686 -130.3274</code></pre>
</div>
</div>
</section>
<section id="qualche-cenno-alle-performance" class="level2">
<h2 class="anchored" data-anchor-id="qualche-cenno-alle-performance">Qualche cenno alle performance</h2>
<p>Nonostante producano lo stesso risultato, le tre funzioni non hanno la stessa efficienza in termini di tempo.</p>
<p>Una funzione <strong>nativamente</strong> vettorizzata è tipicamente più rapida di una conversione.</p>
<p>Possiamo misurare le <strong>performance</strong> usando, ad esempio, il pacchetto <code>microbenchmark</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(microbenchmark) <span class="co"># Se assente, va installata</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a><span class="fu">microbenchmark</span>(</span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">L1 =</span> <span class="fu">loglik</span>(<span class="fu">c</span>(<span class="fl">0.01</span>, <span class="fl">0.02</span>, <span class="fl">0.03</span>), y),</span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">L2 =</span> <span class="fu">loglik2</span>(<span class="fu">c</span>(<span class="fl">0.01</span>, <span class="fl">0.02</span>, <span class="fl">0.03</span>), y),</span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">L3 =</span> <span class="fu">loglik3</span>(<span class="fu">c</span>(<span class="fl">0.01</span>, <span class="fl">0.02</span>, <span class="fl">0.03</span>), y)</span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Unit: microseconds
 expr    min      lq     mean  median     uq     max neval
   L1  1.084  1.2690  2.05020  1.6885  1.879  23.795   100
   L2 30.432 31.2375 34.10786 31.8680 32.646 124.829   100
   L3 27.913 28.6120 33.78249 29.2290 32.370  92.659   100</code></pre>
</div>
</div>
</section>
<section id="la-stima-di-massima-verosimiglianza-1" class="level2">
<h2 class="anchored" data-anchor-id="la-stima-di-massima-verosimiglianza-1">La stima di massima verosimiglianza</h2>
<p>La <strong>funzione punteggio</strong> e l’<strong>informazione osservata</strong> del modello esponenziale sono pari a <span class="math display">\[
\ell'(\lambda) = \frac{n}{\lambda} - \sum_{i=1}^ny_i, \qquad j(\lambda) = - \ell''(\lambda) = \frac{n}{\lambda^2}.
\]</span></p>
<p>Entrambe queste funzioni sono utili per motivi inferenziali. Ad esempio la <strong>stima di massima verosimiglianza</strong> si ottiene (nei casi regolari) ponendo <span class="math inline">\(\ell'(\lambda) = 0\)</span>.</p>
<p>In questo caso quindi avremo <span class="math display">\[
\hat{\lambda} = \frac{n}{\sum_{i=1}^ny_i} = \frac{1}{\bar{y}}.
\]</span></p>
<p>L’informazione osservata (in questo caso coincidente con l’informazione attesa) è invece estremamente utile per costruire ad esempio <strong>intervalli di confidenza</strong></p>
<p>La stima di massima verosimiglianza (numerica)</p>
<p>Come vederemo in seguito, risolvere l’equazione <span class="math inline">\(\ell'(\lambda) = 0\)</span> può essere problematico (ovviamente non nel caso esponenziale…).</p>
</section>
<section id="procedure-numeriche" class="level2">
<h2 class="anchored" data-anchor-id="procedure-numeriche">Procedure numeriche</h2>
<p>In questi casi “difficili”, la stima di massima verosimiglianza può essere ottenuta tramite procedure <strong>numeriche</strong>.</p>
<p>In altri termini, utilizzeremo un <strong>algoritmo iterativo</strong> che produce una sequenza di valori <span class="math inline">\(\lambda_1, \lambda_2, \dots\)</span>, tali che, quantomeno idealmente, <span class="math display">\[
\ell(\lambda_{k+1}) \ge \ell(\lambda_k).
\]</span></p>
<p>Il nuovo valore <span class="math inline">\(\lambda_{k+1}\)</span> è tipicamente ottenuto a partire dal valore precedente <span class="math inline">\(\lambda_k\)</span>.</p>
<p>Pertanto, questa tipologia di algoritmi hanno bisogno di un <strong>valore iniziale</strong> <span class="math inline">\(\lambda_1\)</span> definito dall’utente.</p>
<p>Dopo un certo numero di iterazioni, quando non si osservano più variazioni significative in termini di <span class="math inline">\(\lambda\)</span> e/o <span class="math inline">\(\ell(\lambda)\)</span>, l’algoritmo si ferma e si dice che è arrivato a <strong>convergenza</strong>.</p>
</section>
<section id="il-metodo-di-newton-raphson-i" class="level2">
<h2 class="anchored" data-anchor-id="il-metodo-di-newton-raphson-i">Il metodo di Newton-Raphson I</h2>
<p>Nel metodo di <strong>Newton-Raphson</strong>, consideriamo lo sviluppo di Taylor della funzione di log-verosimiglianza <span class="math inline">\(\ell(\lambda)\)</span> nel generico punto <span class="math inline">\(\lambda_k\)</span>, troncato al termine <strong>quadratico</strong> <span class="math display">\[
\ell(\lambda) \approx \ell(\lambda_k) + \ell'(\lambda_k)(\lambda - \lambda_k) +  \frac{\ell''(\lambda_k)}{2}(\lambda - \lambda_k)^2.
\]</span></p>
<p>Massimizziamo tale sviluppo, equivalente a trovare il vertice di una parabola, e quindi otteniamo l’equazione di verosimiglianza approssimata <span class="math display">\[
\ell'(\lambda) - j(\lambda_k)(\lambda - \lambda_k) = 0,
\]</span> che risolta rispetto a <span class="math inline">\(\lambda\)</span> porta allo schema iterativo <span class="math display">\[
\lambda_{k + 1} = \lambda_k + j(\lambda_k)^{-1}\ell'(\lambda_k), \qquad k=1,2,\dots.
\]</span></p>
<div class="callout-note callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Nota
</div>
</div>
<div class="callout-body-container callout-body">
<p>Il metodo considera di fatto una serie di <strong>approssimazioni paraboliche</strong> della log-verosimiglianza, per le quali si va ogni volta a valutare il punto di massimo.</p>
</div>
</div>
</section>
<section id="il-metodo-di-newton-raphson-ii" class="level2">
<h2 class="anchored" data-anchor-id="il-metodo-di-newton-raphson-ii">Il metodo di Newton-Raphson II</h2>
<p>Il metodo <strong>Newton-Raphson</strong> appena descritto si può implementare in come segue:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>lambda <span class="ot">&lt;-</span> <span class="fu">numeric</span>(<span class="dv">10</span>); lambda[<span class="dv">1</span>] <span class="ot">&lt;-</span> <span class="fl">0.005</span> <span class="co"># Punto iniziale (cosa succede cambiandolo?)</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="fu">length</span>(y); sum_y <span class="ot">&lt;-</span> <span class="fu">sum</span>(y)</span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Algorithmo Newton-Raphson</span></span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(k <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>){</span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a>  score <span class="ot">&lt;-</span> n <span class="sc">/</span> lambda[k] <span class="sc">-</span> sum_y <span class="co"># Funzione score</span></span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a>  obs_info <span class="ot">&lt;-</span> n <span class="sc">/</span> lambda[k]<span class="sc">^</span><span class="dv">2</span> <span class="co"># Informazione osservata</span></span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a>  lambda[k <span class="sc">+</span> <span class="dv">1</span>] <span class="ot">&lt;-</span> lambda[k] <span class="sc">+</span> score <span class="sc">/</span> obs_info <span class="co"># Passo iterativo</span></span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(<span class="fu">c</span>(lambda[k <span class="sc">+</span> <span class="dv">1</span>], <span class="fu">loglik</span>(lambda[k <span class="sc">+</span> <span class="dv">1</span>], y)), <span class="at">digits =</span> <span class="dv">3</span>) <span class="co"># Mostro i risultati</span></span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1]    0.0084 -127.6403
[1]    0.0123 -124.4969
[1]    0.0149 -123.8855
[1]    0.0156 -123.8601
[1]    0.0156 -123.8600</code></pre>
</div>
</div>
<p>Il risultato esatto, in questo caso, è facile da calcolare e lo riportiamo per un confronto:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>lambda_hat <span class="ot">&lt;-</span> <span class="dv">1</span> <span class="sc">/</span> <span class="fu">mean</span>(y)</span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a><span class="fu">c</span>(lambda_hat, <span class="fu">loglik</span>(lambda_hat, y))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1]    0.01559454 -123.86002328</code></pre>
</div>
</div>
</section>
<section id="metodi-di-massimizzazione" class="level2">
<h2 class="anchored" data-anchor-id="metodi-di-massimizzazione">Metodi di massimizzazione</h2>
<p>In pratica, in <strong>R</strong> esistono diverse funzioni per la massimizzazione, basate su varie elaborazioni del metodo di Newton-Raphson (che noi non vedremo).</p>
<p>Tutte queste funzioni richiedono un <strong>valore iniziale</strong> ma non necessitano dei valori delle derivate, che vengono approssimate internamente.</p>
<p>Le funzioni richiedono inoltre un qualche <strong>criterio di arresto</strong>.</p>
<p>Alcuni metodi permettono l’utilizzo di <strong>vincoli sui parametri</strong>.</p>
<div class="callout-note callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Nota
</div>
</div>
<div class="callout-body-container callout-body">
<p>Per ragioni storiche, le funzioni di <strong>R</strong> identificano sempre il minimo della funzione cercata. Tuttavia: <span class="math display">\[
\arg \max_{\lambda \in \mathbb{R}} \:\ell(\lambda) = \arg \min_{\lambda \in \mathbb{R}} \:- \ell(\lambda).
\]</span> In altri termini, è sufficiente <strong>cambiare di segno</strong> la funzione obiettivo.</p>
</div>
</div>
</section>
<section id="la-funzione-nlminb" class="level2">
<h2 class="anchored" data-anchor-id="la-funzione-nlminb">La funzione <code>nlminb</code></h2>
<p>La funzione <code>nlminb</code> effettua <strong>minimizzazioni numeriche</strong>, anche vettoriali.</p>
<p>È una routine generalmente considerata più stabile, robusta ed affidabile della funzione concorrente <code>optim</code>, che vedremo in seguito.</p>
<p>Inoltre, consente di incorporare dei <strong>vincoli</strong> sui parametri, qualora questi fossero presenti.</p>
<p>Nel modello esponenziale, per esempio, si ha il vincolo <span class="math inline">\(\lambda &gt; 0\)</span>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="co"># start = 1 significa che il valore iniziale è pari a 1</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a><span class="co"># lower = 1e-5 implica che lambda &gt; 0</span></span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>fit_exp <span class="ot">&lt;-</span> <span class="fu">nlminb</span>(<span class="at">start =</span> <span class="dv">1</span>, <span class="at">objective =</span> <span class="cf">function</span>(lambda) <span class="sc">-</span> <span class="fu">loglik</span>(lambda, y), <span class="at">lower =</span> <span class="fl">1e-5</span>)</span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a>fit_exp</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>$par
[1] 0.01559454

$objective
[1] 123.86

$convergence
[1] 0

$iterations
[1] 16

$evaluations
function gradient 
      24       19 

$message
[1] "relative convergence (4)"</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>lambda_hat <span class="ot">&lt;-</span> fit_exp<span class="sc">$</span>par <span class="co"># Stima di massima verosimiglianza</span></span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a><span class="fu">curve</span>(<span class="fu">loglik</span>(x, y), <span class="fl">0.001</span>, <span class="fl">0.05</span>)</span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">v =</span> lambda_hat, <span class="at">lty =</span> <span class="st">"dotted"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="un_K_files/figure-html/unnamed-chunk-11-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="fu">optim</span>(<span class="at">par =</span> <span class="dv">1</span>, <span class="at">fn =</span> <span class="cf">function</span>(lambda) <span class="sc">-</span> <span class="fu">loglik</span>(lambda, y), <span class="at">lower =</span> <span class="fl">1e-5</span>, <span class="at">method =</span> <span class="st">"L-BFGS-B"</span>, <span class="at">hessian =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>$par
[1] 0.01561446

$value
[1] 123.86

$counts
function gradient 
      29       29 

$convergence
[1] 0

$message
[1] "CONVERGENCE: REL_REDUCTION_OF_F &lt;= FACTR*EPSMCH"

$hessian
         [,1]
[1,] 99253.17</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Informazione osservata</span></span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>obs_info <span class="ot">&lt;-</span> <span class="fu">length</span>(y) <span class="sc">/</span> lambda_hat<span class="sc">^</span><span class="dv">2</span></span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a>obs_info</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 98688.38</code></pre>
</div>
</div>
</section>
<section id="adeguatezza-del-modello" class="level2">
<h2 class="anchored" data-anchor-id="adeguatezza-del-modello">Adeguatezza del modello</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">ecdf</span>(y))</span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a><span class="fu">curve</span>(<span class="fu">pexp</span>(x, lambda_hat), <span class="at">col =</span> <span class="st">"red"</span>, <span class="at">add =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="un_K_files/figure-html/unnamed-chunk-14-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="parametro-vettoriale-il-modello-weibull-i" class="level2">
<h2 class="anchored" data-anchor-id="parametro-vettoriale-il-modello-weibull-i">Parametro vettoriale: il modello Weibull I</h2>
<p>Sia <span class="math inline">\(y = (y_1,\dots,y_n)\)</span> un campione iid da una variabile casuale Weibull di <strong>parametri</strong> <span class="math inline">\((\gamma, \beta)\)</span>, ovvero <span class="math inline">\(Y \sim \text{Weib}(\gamma, \beta)\)</span>.</p>
<p>Si ricordi che la densità di un modello Weibull è <span class="math display">\[
f(y; \gamma, \beta) = \frac{\gamma}{\beta} \left(\frac{y}{\beta}\right)^{\gamma - 1} e^{-(y / \beta)^\gamma}, \qquad y, \gamma, \beta &gt; 0.
\]</span></p>
<p>Di conseguenza, la funzione di <strong>log-verosimiglianza</strong> associata al campione <span class="math inline">\(y\)</span> è <span class="math display">\[
\ell(\gamma, \beta) = \ell(\gamma, \beta; y) = n \log \gamma - n \gamma \log \beta + \gamma \sum_{i=1}^n\log y_i - \sum_{i=1}^n \left(\frac{y_i}{\beta}\right)^\gamma.
\]</span></p>
<div class="callout-note callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Esercizio
</div>
</div>
<div class="callout-body-container callout-body">
<p>Si ottenga la precedente log-verosimiglianza (carta e penna)</p>
</div>
</div>
</section>
<section id="parametro-vettoriale-il-modello-weibull-ii" class="level2">
<h2 class="anchored" data-anchor-id="parametro-vettoriale-il-modello-weibull-ii">Parametro vettoriale: il modello Weibull II</h2>
<p>La funzione che calcola la verosimiglianza in <strong>R</strong> può essere implementata in vari modi. Ne presentiamo qui uno dei tanti basato sulla funzione <code>dweibull</code></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a>loglik <span class="ot">&lt;-</span> <span class="cf">function</span>(par, y) {</span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">sum</span>(<span class="fu">dweibull</span>(y, <span class="at">shape =</span> par[<span class="dv">1</span>], <span class="at">scale =</span> par[<span class="dv">2</span>], <span class="at">log =</span> <span class="cn">TRUE</span>))</span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Siamo interessati a capire se il modello Weibull, che <strong>generalizza</strong> quello esponenziale, rappresenta una scelta modellistica migliore.</p>
<p>Consideriamo anche in questo caso il dataset <code>aircondit7</code> della libreria <code>boot</code>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(boot)</span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(<span class="st">"aircondit7"</span>)</span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a>y <span class="ot">&lt;-</span> aircondit7<span class="sc">$</span>hours</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="grafico-della-verosimiglianza-i-facoltativo" class="level2">
<h2 class="anchored" data-anchor-id="grafico-della-verosimiglianza-i-facoltativo">Grafico della verosimiglianza I (facoltativo)</h2>
<p>In generale non è possibile disegnare dei grafici della verosimiglianza con parametri vettoriali.</p>
<p>L’unica eccezione è il caso <span class="math inline">\(p = 2\)</span>, in cui possiamo usare i cosiddetti grafici <code>contour</code>, basati sulle <strong>curve di livello</strong>.</p>
<p>Per fare questo tipo di grafico, bisogna procedere per step.</p>
<ul>
<li><p><strong>Step 1</strong>. Anzitutto bisogna definire un per ciascuna componente del parametro.</p></li>
<li><p><strong>Step 2</strong>. Bisogna quindi calcolare la log-verosimiglianza in ciascuna coppia di punti della griglia definita dal <strong>prodotto cartesiano</strong> dei due intervalli.</p></li>
</ul>
</section>
<section id="grafico-della-verosimiglianza-ii-facoltativo" class="level2">
<h2 class="anchored" data-anchor-id="grafico-della-verosimiglianza-ii-facoltativo">Grafico della verosimiglianza II (facoltativo)</h2>
<p>Gli estremi degli intervalli vanno scelti <strong>manualmente</strong>. In pratica, bisogna procedere per tentativi se si vuole disegnare la verosimiglianza in una regione “sensata”.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Definizione degli intervalli di punti</span></span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a>gamma <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="fl">0.1</span>, <span class="fl">2.25</span>, <span class="at">length =</span> <span class="dv">200</span>)</span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a>beta <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="fl">0.5</span>, <span class="dv">400</span>, <span class="at">length =</span> <span class="dv">200</span>)</span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-5"><a href="#cb38-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Ottenimento della griglia tramite prodotto cartesiano </span></span>
<span id="cb38-6"><a href="#cb38-6" aria-hidden="true" tabindex="-1"></a>parvalues <span class="ot">&lt;-</span> <span class="fu">expand.grid</span>(gamma, beta)</span>
<span id="cb38-7"><a href="#cb38-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-8"><a href="#cb38-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Calcolo valori di verosimiglianza</span></span>
<span id="cb38-9"><a href="#cb38-9" aria-hidden="true" tabindex="-1"></a>llikvalues <span class="ot">&lt;-</span> <span class="fu">apply</span>(parvalues, <span class="dv">1</span>, loglik, <span class="at">y =</span> y)</span>
<span id="cb38-10"><a href="#cb38-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-11"><a href="#cb38-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Ri-organizzazione dei valori della log-verosimiglianza in forma matriciale</span></span>
<span id="cb38-12"><a href="#cb38-12" aria-hidden="true" tabindex="-1"></a>llikvalues <span class="ot">&lt;-</span> <span class="fu">matrix</span>(llikvalues, <span class="at">nrow =</span> <span class="fu">length</span>(gamma), <span class="at">ncol =</span> <span class="fu">length</span>(beta), <span class="at">byrow =</span> F)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Quindi, il grafico <code>contour</code> oppure sua variante <code>filled.contour</code> si possono ottenere abbastanza facilmente.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="fu">contour</span>(gamma, beta, llikvalues,</span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">xlab =</span> <span class="fu">expression</span>(gamma), <span class="at">ylab =</span> <span class="fu">expression</span>(beta), <span class="co"># Produce le lettere greche nel grafico</span></span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">levels =</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="sc">-</span><span class="dv">140</span>, <span class="at">to =</span> <span class="sc">-</span><span class="dv">120</span>, <span class="at">by =</span> <span class="dv">2</span>),</span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">main =</span> <span class="st">"Log-verosimiglianza (Modello Weibull)"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="un_K_files/figure-html/unnamed-chunk-18-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="fu">filled.contour</span>(gamma, beta, llikvalues,</span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">xlab =</span> <span class="fu">expression</span>(gamma), <span class="at">ylab =</span> <span class="fu">expression</span>(beta),</span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">levels =</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="sc">-</span><span class="dv">140</span>, <span class="at">to =</span> <span class="sc">-</span><span class="dv">120</span>, <span class="at">by =</span> <span class="dv">1</span>),</span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">col =</span> <span class="fu">terrain.colors</span>(<span class="dv">20</span>), <span class="at">main =</span> <span class="st">"Log-verosimiglianza (Modello Weibull)"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="un_K_files/figure-html/unnamed-chunk-19-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="stima-di-massima-verosimiglianza" class="level2">
<h2 class="anchored" data-anchor-id="stima-di-massima-verosimiglianza">Stima di massima verosimiglianza</h2>
<p>Nel caso Weibull la <strong>funzione punteggio</strong> è un vettore di dimensione due, che conduce alle <span class="math display">\[
\begin{aligned}
\frac{\partial}{\partial \gamma}\ell(\gamma, \beta) &amp; = \frac{n}{\gamma} - n \log\beta + \sum_{i=1}^n\log{y_i} - \sum_{i=1}^n\left(\frac{y_i}{\beta}\right)^\gamma \log\left(\frac{y_i}{\beta}\right) = 0, \\
\frac{\partial}{\partial \beta}\ell(\gamma, \beta) &amp;= - \frac{n \gamma}{\beta} +\frac{\gamma}{\beta^{\gamma+1}} \sum_{i=1}^ny_i^\gamma = 0.
\end{aligned}
\]</span></p>
<p>Risolvendo la seconda equazione otteniamo la stima vincolata <span class="math inline">\(\hat{\beta}_\gamma = \left(\frac{1}{n}\sum_{i=1}^n y_i^\gamma \right)^{1/\gamma}\)</span>, per ogni <span class="math inline">\(\gamma\)</span> fissato.</p>
<div class="callout-note callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Problema chiave
</div>
</div>
<div class="callout-body-container callout-body">
<p>Sostituendo <span class="math inline">\(\hat{\beta}_\gamma\)</span> nella prima equazione otteniamo quindi: <span class="math display">\[
\frac{n}{\gamma} + \sum_{i=1}^n\log y_i - n \frac{\sum_{i=1}^n y_i^\gamma \log y_i}{\sum_{i=1}^n y_i^\gamma} = 0.
\]</span> Quest’ultima equazione purtroppo <strong>non</strong> ammette una <strong>soluzione analitica</strong>.</p>
</div>
</div>
</section>
<section id="stima-di-massima-verosimiglianza-1" class="level2">
<h2 class="anchored" data-anchor-id="stima-di-massima-verosimiglianza-1">Stima di massima verosimiglianza</h2>
<p>Per trovare la <strong>stima</strong> di <strong>massima verosimiglianza</strong> dobbiamo quindi procedere per via numerica.</p>
<p>Sebbene esistano in <strong>R</strong> dei comandi che calcolano gli zeri di una funzione (<code>uniroot</code>), per identificare il massimo è numericamente più stabile far uso di funzioni dedicate.</p>
<p>Oltretutto, questo ci evita di dover fare dei conti analitici, come la derivata prima.</p>
<p>Anche in questo caso bivariato, si è specificato il <strong>limite inferiore</strong> del dominio della funzione, ovvero <span class="math inline">\(\gamma, \beta &gt; 0\)</span>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a>fit_weibull <span class="ot">&lt;-</span> <span class="fu">nlminb</span>(<span class="at">start =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">1</span>), <span class="cf">function</span>(par) <span class="sc">-</span><span class="fu">loglik</span>(par, y), <span class="at">lower =</span> <span class="fu">c</span>(<span class="fl">1e-7</span>, <span class="fl">1e-7</span>))</span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a>fit_weibull</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>$par
[1]  1.024919 64.792419

$objective
[1] 123.8483

$convergence
[1] 0

$iterations
[1] 21

$evaluations
function gradient 
      22       49 

$message
[1] "relative convergence (4)"</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">ecdf</span>(y))</span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a><span class="fu">curve</span>(<span class="fu">pexp</span>(x, fit_exp<span class="sc">$</span>par), <span class="at">col =</span> <span class="st">"red"</span>, <span class="at">add =</span> <span class="cn">TRUE</span>)</span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a><span class="fu">curve</span>(<span class="fu">pweibull</span>(x, fit_weibull<span class="sc">$</span>par[<span class="dv">1</span>], fit_weibull<span class="sc">$</span>par[<span class="dv">2</span>]), <span class="at">col =</span> <span class="st">"blue"</span>, <span class="at">add =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="un_K_files/figure-html/unnamed-chunk-21-1.png" class="img-fluid" width="672"></p>
</div>
</div>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    setTimeout(function() {
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const cites = ref.parentNode.getAttribute('data-cites').split(' ');
    tippyHover(ref, function() {
      var popup = window.document.createElement('div');
      cites.forEach(function(cite) {
        var citeDiv = window.document.createElement('div');
        citeDiv.classList.add('hanging-indent');
        citeDiv.classList.add('csl-entry');
        var biblioDiv = window.document.getElementById('ref-' + cite);
        if (biblioDiv) {
          citeDiv.innerHTML = biblioDiv.innerHTML;
        }
        popup.appendChild(citeDiv);
      });
      return popup.innerHTML;
    });
  }
});
</script>
</div> <!-- /content -->



</body></html>